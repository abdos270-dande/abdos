<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„Ù‚Ø±Ø¹Ø©</title>
  <style>
    body { font-family: Arial; text-align: center; padding: 40px; direction: rtl; }
    .winner { background: gold; padding: 30px; font-size: 2em; margin-top: 20px; }
    .countdown { font-size: 24px; margin: 10px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>Ù‚Ø±Ø¹Ø© Ø§Ù„ÙŠÙˆÙ…</h1>
  <div class="countdown" id="timer">ØªØ­Ù…ÙŠÙ„...</div>
  <div id="result" class="winner hidden"></div>

  <script>
    const timerEl = document.getElementById("timer");
    const resultEl = document.getElementById("result");

    async function fetchStatus() {
      const res = await fetch("/lottery_status.php");
      const data = await res.json();

      if (data.status === "done") {
        timerEl.style.display = "none";
        resultEl.classList.remove("hidden");
        resultEl.textContent = `ðŸŽ‰ Ø§Ù„ÙØ§Ø¦Ø² Ù‡Ùˆ: ${data.winner}`;
      } else if (data.status === "pending") {
        const drawTime = new Date(data.draw_time).getTime();
        startCountdown(drawTime);
      }
    }

    function startCountdown(targetTime) {
      const timer = setInterval(async () => {
        const now = new Date().getTime();
        const diff = targetTime - now;

        if (diff <= 0) {
          clearInterval(timer);
          timerEl.textContent = "ðŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ§Ø¦Ø²...";
          const res = await fetch("/pick_winner.php");
          const result = await res.json();
          if (result.status === "success") {
            resultEl.classList.remove("hidden");
            resultEl.textContent = `ðŸŽ‰ Ø§Ù„ÙØ§Ø¦Ø² Ù‡Ùˆ: ${result.winner}`;
            timerEl.style.display = "none";
          } else {
            resultEl.textContent = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±.";
          }
        } else {
          const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
          const secs = Math.floor((diff % (1000 * 60)) / 1000);
          timerEl.textContent = `â³ ØªØ¨Ù‚Ù‰ Ø¹Ù„Ù‰ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù‚Ø±Ø¹Ø©: ${mins} Ø¯Ù‚ÙŠÙ‚Ø© Ùˆ ${secs} Ø«Ø§Ù†ÙŠØ©`;
        }
      }, 1000);
    }

    fetchStatus();
  </script>
</body>
</html>
